<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AlphaClients</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              neon: {
                DEFAULT: '#39ff14', 
                dim: '#15803d',
                glow: 'rgba(57, 255, 20, 0.5)'
              },
              dark: {
                bg: '#050505',
                surface: '#111111', 
                border: '#222222'
              }
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['Fira Code', 'Courier New', 'monospace'],
            },
          },
        },
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Babel Standalone for in-browser JSX/TS compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map CORRIGIDO: Apenas uma vers√£o do React (18.2.0) -->
    <!-- Removido qualquer refer√™ncia ao React 19 ou Vite para evitar o Erro #31 -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>

    <style>
      body {
        background-color: #050505;
        color: #e2e8f0;
      }
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #111111; 
      }
      ::-webkit-scrollbar-thumb {
        background: #222222; 
        border-radius: 4px;
        border: 1px solid #000;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #39ff14; 
      }
      .animate-fade-in {
        animation: fadeIn 0.5s ease-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- MAIN APP SCRIPT -->
    <script type="text/babel" data-type="module" data-presets="react,typescript">
      import React, { useState, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI } from '@google/genai';

      // --- CONFIG ---
      // COLOQUE SUA API KEY AQUI SE DESEJAR, OU DEIXE EM BRANCO PARA O APP PEDIR NA TELA
      const HARDCODED_API_KEY = ""; 
      const MODEL_ID = "gemini-2.5-flash";

      // --- SERVICES ---
      // Adaptado para funcionar no browser (sem process.env e imports externos)

      const getAIClient = (userKey) => {
        const key = userKey || HARDCODED_API_KEY || localStorage.getItem('GEMINI_API_KEY');
        if (!key) throw new Error("API Key n√£o fornecida");
        return new GoogleGenAI({ apiKey: key });
      };

      const searchPlaces = async (query, location, apiKey) => {
        try {
          const ai = getAIClient(apiKey);
          const prompt = `
            Atue como um assistente de prospec√ß√£o de clientes chamado AlphaClients.
            Tarefa: Localize empresas, lojas ou servi√ßos correspondentes a: "${query}".
            Contexto de Localiza√ß√£o: ${location ? `Latitude: ${location.latitude}, Longitude: ${location.longitude}` : "Use a localiza√ß√£o geral baseada na query ou padr√£o global"}.
            IMPORTANTE - FORMATO DE SA√çDA:
            Voc√™ deve listar os resultados encontrados. Para cada resultado, gere EXATAMENTE uma linha seguindo este padr√£o (separado por duas barras verticais '||'):
            {Link Completo do Google Maps} || {Nome exato do local} || {Telefone} || {Infos Completas}
            Regras de Formata√ß√£o:
            1. Use EXATAMENTE "||" como separador. N√ÉO use apenas uma barra "/".
            2. O Link deve ser o URL completo (come√ßando com https://).
            3. Se n√£o encontrar telefone, escreva "S/ Tel".
            Regras de Conte√∫do ({Infos Completas}):
            - INCLUA O ENDERE√áO COMPLETO (Rua, N√∫mero, Bairro, CEP, Cidade, Estado).
            - INCLUA NOTA E AVALIA√á√ïES (Ex: 4.8 ‚≠ê (120 reviews)).
            - CRUCIAL: Liste os HOR√ÅRIOS DE FUNCIONAMENTO COMPLETOS para todos os dias da semana dispon√≠veis (Segunda a Domingo). Seja extenso.
            - Se houver site, inclua no final das infos.
          `;
          
          const config = { tools: [{ googleMaps: {} }] };
          if (location) {
            config.toolConfig = { retrievalConfig: { latLng: { latitude: location.latitude, longitude: location.longitude } } };
          }

          const response = await ai.models.generateContent({
            model: MODEL_ID,
            contents: prompt,
            config: config,
          });

          const text = response.text || "Nenhum resultado textual encontrado.";
          return { text, chunks: response.candidates?.[0]?.groundingMetadata?.groundingChunks || [] };
        } catch (error) {
          console.error("Gemini API Error:", error);
          throw new Error(error.message || "Falha na conex√£o.");
        }
      };

      const refineResults = async (currentData, instruction, apiKey) => {
        try {
          const ai = getAIClient(apiKey);
          const prompt = `
            Atue como o AlphaClients AI Refiner.
            Lista Atual: ${currentData}
            Instru√ß√£o: "${instruction}"
            TAREFA: Analise e modifique a lista conforme pedido (filtro, tradu√ß√£o, formata√ß√£o). Mantenha formato: {Link} || {Nome} || {Telefone} || {Infos}
          `;
          const response = await ai.models.generateContent({ model: MODEL_ID, contents: prompt });
          return response.text || currentData;
        } catch (error) {
          throw new Error("Falha ao refinar os resultados.");
        }
      };

      // --- COMPONENTS ---

      const SearchInput = ({ value, onChange, onSearch, isLoading }) => {
        const handleKeyDown = (e) => {
          if (e.key === 'Enter' && !e.shiftKey && !isLoading) {
            e.preventDefault(); 
            onSearch();
          }
        };

        return (
          <div className="relative w-full max-w-4xl mx-auto group">
            <div className="absolute top-5 left-4 pointer-events-none">
              <svg aria-hidden="true" className="w-6 h-6 text-neon transition-all group-focus-within:drop-shadow-[0_0_5px_rgba(57,255,20,0.8)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
            <textarea
              className="block w-full h-32 p-4 pl-14 text-base md:text-lg text-white border-2 border-dark-border rounded-xl bg-dark-surface focus:ring-2 focus:ring-neon focus:border-neon placeholder-gray-500 outline-none transition-all shadow-lg font-mono tracking-wide resize-none custom-scrollbar leading-relaxed"
              placeholder="Descreva detalhadamente o que procura...&#10;Ex: Sal√µes de beleza com nota acima de 4.0, que abrem de segunda-feira e ficam no centro..."
              value={value}
              onChange={(e) => onChange(e.target.value)}
              onKeyDown={handleKeyDown}
              disabled={isLoading}
            />
            <button
              onClick={onSearch}
              disabled={isLoading}
              className={`absolute right-4 bottom-4 bg-neon hover:bg-green-400 focus:ring-4 focus:outline-none focus:ring-neon-dim font-bold rounded-lg text-sm px-6 py-2 text-black transition-all transform active:scale-95 uppercase tracking-wider shadow-lg ${isLoading ? 'opacity-70 cursor-not-allowed' : ''}`}
            >
              {isLoading ? (
                <div className="flex items-center gap-2">
                  <svg className="animate-spin h-4 w-4 text-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Buscando...
                </div>
              ) : (
                'PESQUISAR'
              )}
            </button>
          </div>
        );
      };

      const ResultsDisplay = ({ rawText }) => {
        const [parsedLines, setParsedLines] = useState([]);
        const [copied, setCopied] = useState(false);

        const handleCopyAll = () => {
          const cleanText = parsedLines.map(l => l.rawLine).join('\n');
          navigator.clipboard.writeText(cleanText).then(() => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          });
        };

        useEffect(() => {
          if (!rawText) return;

          const lines = rawText.split('\n');
          const parsed = [];

          lines.forEach(line => {
            if (!line.trim()) return;
            const parts = line.split('||').map(s => s.trim());
            
            if (parts.length >= 3) {
              const link = parts[0] || '#';
              const name = parts[1] || 'Desconhecido';
              const phone = parts[2] || 'S/ Tel';
              const infos = parts.slice(3).join(' ').trim() || '';
              const displayRawLine = `${link} / ${name} / ${phone} / ${infos}`;

              parsed.push({
                link, name, phone, infos, rawLine: displayRawLine
              });
            }
          });
          setParsedLines(parsed);
        }, [rawText]);

        if (!rawText) return null;

        return (
          <div className="w-full max-w-7xl mx-auto mt-8">
            <div className="flex flex-col md:flex-row justify-between items-end md:items-center mb-4 gap-4 border-b border-dark-border pb-4">
              <div>
                <h2 className="text-2xl font-bold text-white flex items-center gap-3">
                  <span className="text-neon animate-pulse">‚ö°</span> 
                  Resultados Encontrados
                </h2>
                <p className="text-gray-400 text-sm mt-1">Total: {parsedLines.length} leads localizados</p>
              </div>
              <button
                onClick={handleCopyAll}
                className={`px-6 py-3 rounded-lg text-base font-bold transition-all shadow-lg flex items-center gap-2 transform hover:-translate-y-1 ${
                  copied 
                    ? 'bg-white text-black ring-2 ring-neon' 
                    : 'bg-dark-surface border border-neon text-neon hover:bg-neon hover:text-black'
                }`}
              >
                {copied ? <>‚úì LEADS COPIADOS!</> : <>üìã COPIAR LISTA COMPLETA</>}
              </button>
            </div>
            
            <div className="bg-dark-surface rounded-xl shadow-2xl border border-dark-border overflow-hidden ring-1 ring-white/5">
              <div className="p-4 bg-black/40 border-b border-dark-border flex gap-4 text-xs uppercase tracking-widest font-semibold text-gray-500">
                <div className="w-16 shrink-0 text-center">Abrir</div>
                <div className="flex-1">Dados Detalhados (Link / Nome / Tel / Info)</div>
              </div>

              <div className="max-h-[600px] overflow-y-auto custom-scrollbar">
                {parsedLines.length > 0 ? (
                  parsedLines.map((item, idx) => (
                    <div 
                      key={idx} 
                      className={`p-4 border-b border-dark-border flex gap-4 items-start group transition-colors ${idx % 2 === 0 ? 'bg-transparent' : 'bg-white/5'} hover:bg-white/10`}
                    >
                      <div className="w-16 shrink-0 pt-2 flex justify-center">
                          <a 
                            href={item.link} 
                            target="_blank" 
                            rel="noreferrer"
                            className="flex items-center justify-center w-10 h-10 rounded-full bg-dark-bg border border-neon/30 text-neon hover:bg-neon hover:text-black transition-all shadow-lg hover:scale-110"
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                          </a>
                      </div>
                      <div className="flex-1 font-mono text-sm md:text-base break-words leading-relaxed pt-1">
                          <a href={item.link} target="_blank" rel="noreferrer" className="text-neon font-bold text-base block mb-2 hover:underline truncate max-w-full">
                            {item.link}
                          </a>
                          <div className="text-white/90 space-y-2">
                            <div className="flex flex-wrap items-baseline gap-x-3">
                              <span className="font-extrabold text-white text-lg">{item.name}</span>
                              <span className="text-gray-600">/</span>
                              <span className="text-yellow-400 font-bold">{item.phone}</span>
                            </div>
                            <div className="flex items-start gap-2 text-gray-400 text-sm border-l-2 border-neon/30 pl-3 py-1 mt-1 bg-white/5 rounded-r-lg">
                                <span className="mt-0.5">‚ÑπÔ∏è</span>
                                <span>{item.infos}</span>
                            </div>
                          </div>
                      </div>
                    </div>
                  ))
                ) : (
                  <div className="p-12 text-center text-gray-600 italic">
                    {rawText}
                  </div>
                )}
              </div>
            </div>
            <p className="text-center text-xs text-gray-500 mt-4 font-mono">Formato de C√≥pia: &#123;Link&#125; / &#123;Nome&#125; / &#123;Telefone&#125; / &#123;Infos&#125;</p>
          </div>
        );
      };

      // --- APP COMPONENT ---
      const App = () => {
        const [currentPage, setCurrentPage] = useState('home');
        const [query, setQuery] = useState('');
        const [refinementQuery, setRefinementQuery] = useState('');
        const [coords, setCoords] = useState(undefined);
        const [locationStatus, setLocationStatus] = useState('Detectando...');
        const [searchState, setSearchState] = useState({ isLoading: false, data: null, error: null });
        const [isRefining, setIsRefining] = useState(false);
        const [apiKey, setApiKey] = useState(HARDCODED_API_KEY || localStorage.getItem('GEMINI_API_KEY') || '');

        useEffect(() => {
          if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
              (pos) => {
                setCoords({ latitude: pos.coords.latitude, longitude: pos.coords.longitude });
                setLocationStatus('Ativo');
              },
              () => setLocationStatus('Inativo')
            );
          } else {
            setLocationStatus('N/A');
          }
        }, []);

        const saveKey = (key) => {
          setApiKey(key);
          localStorage.setItem('GEMINI_API_KEY', key);
        };

        const handleSearch = async () => {
          if (!query.trim()) return;
          if (!apiKey) { alert("Por favor, insira sua API Key do Gemini."); return; }
          
          setSearchState({ isLoading: true, data: null, error: null });
          setRefinementQuery('');

          try {
            const result = await searchPlaces(query, coords, apiKey);
            setSearchState({ isLoading: false, data: result.text, error: null });
          } catch (err) {
            setSearchState({ isLoading: false, data: null, error: err.message });
          }
        };

        const handleRefinement = async () => {
          if (!refinementQuery.trim() || !searchState.data) return;
          setIsRefining(true);
          try {
            const newData = await refineResults(searchState.data, refinementQuery, apiKey);
            setSearchState(prev => ({ ...prev, data: newData }));
            setRefinementQuery('');
          } catch (err) {
            setSearchState(prev => ({ ...prev, error: "Erro ao modificar resultados." }));
          } finally {
            setIsRefining(false);
          }
        };

        return (
          <div className="min-h-screen bg-dark-bg text-gray-200 font-sans selection:bg-neon selection:text-black">
            <nav className="fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-md border-b border-dark-border h-16 flex items-center px-6 justify-between">
              <div onClick={() => setCurrentPage('home')} className="cursor-pointer flex items-center gap-2 group">
                  <div className="w-3 h-3 bg-neon rounded-full group-hover:animate-ping"></div>
                  <span className="font-bold text-xl tracking-tight text-white">ALPHA<span className="text-neon">CLIENTS</span></span>
              </div>
              <div className="flex items-center gap-4 text-xs font-mono">
                  <span className={`px-2 py-1 rounded border ${coords ? 'border-neon/50 text-neon' : 'border-red-500/50 text-red-500'}`}>
                    GPS: {locationStatus}
                  </span>
                  {currentPage === 'dashboard' && (
                      <button onClick={() => setCurrentPage('home')} className="text-gray-400 hover:text-white transition-colors">Voltar</button>
                  )}
              </div>
            </nav>

            <div className="pt-20 pb-10 px-4 md:px-8 max-w-7xl mx-auto min-h-screen flex flex-col">
              {currentPage === 'home' && (
                <div className="flex flex-col items-center justify-center flex-1 text-center animate-fade-in space-y-12">
                  <div className="space-y-6 max-w-4xl">
                    <div className="inline-block px-4 py-1 rounded-full bg-white/5 border border-white/10 text-neon text-sm font-mono mb-4">
                      v2.1 ‚Ä¢ Powered by Gemini Flash 2.5
                    </div>
                    <h1 className="text-5xl md:text-7xl font-extrabold text-white tracking-tight leading-tight">
                      Encontre Clientes Reais em <br/>
                      <span className="text-transparent bg-clip-text bg-gradient-to-r from-neon to-green-600">Segundos.</span>
                    </h1>
                    <p className="text-xl text-gray-400 max-w-2xl mx-auto">
                      Ferramenta de prospec√ß√£o inteligente com IA e Google Maps.
                    </p>
                    
                    {!apiKey && (
                       <div className="max-w-md mx-auto mt-4 p-4 bg-white/5 rounded-xl border border-neon/30">
                          <label className="block text-xs text-neon mb-2">INSIRA SUA API KEY DO GEMINI PARA COME√áAR:</label>
                          <input 
                            type="password" 
                            placeholder="Cole sua chave aqui..." 
                            className="w-full bg-black border border-dark-border rounded px-3 py-2 text-white text-center focus:border-neon outline-none"
                            onChange={(e) => saveKey(e.target.value)}
                            value={apiKey}
                          />
                          <p className="text-[10px] text-gray-500 mt-2">A chave √© salva no seu navegador.</p>
                       </div>
                    )}

                    <button 
                      onClick={() => setCurrentPage('dashboard')}
                      disabled={!apiKey}
                      className={`mt-8 px-10 py-5 font-extrabold text-lg rounded-xl transition-all shadow-[0_0_30px_rgba(57,255,20,0.3)] ${apiKey ? 'bg-neon text-black hover:bg-white hover:scale-105' : 'bg-gray-800 text-gray-500 cursor-not-allowed'}`}
                    >
                      {apiKey ? 'COME√áAR AGORA ‚ûî' : 'INSIRA A CHAVE ACIMA'}
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-5xl mt-12 text-left">
                     <div className="p-6 rounded-2xl bg-dark-surface border border-dark-border"><h3 className="text-xl font-bold text-white mb-2">ü§ñ IA Inteligente</h3></div>
                     <div className="p-6 rounded-2xl bg-dark-surface border border-dark-border"><h3 className="text-xl font-bold text-white mb-2">üó∫Ô∏è Google Maps</h3></div>
                     <div className="p-6 rounded-2xl bg-dark-surface border border-dark-border"><h3 className="text-xl font-bold text-white mb-2">‚ö° Copiar & Colar</h3></div>
                  </div>
                </div>
              )}

              {currentPage === 'dashboard' && (
                <div className="flex-1 flex flex-col w-full animate-fade-in">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-white mb-6">Painel de Busca</h2>
                    <SearchInput value={query} onChange={setQuery} onSearch={handleSearch} isLoading={searchState.isLoading} />
                  </div>

                  {searchState.error && (
                      <div className="w-full max-w-2xl mx-auto p-4 mb-4 text-red-400 bg-red-900/10 border border-red-900 rounded-lg text-center font-mono text-sm">
                        ‚ö†Ô∏è {searchState.error}
                      </div>
                  )}

                  {!searchState.data && !searchState.isLoading && !searchState.error && (
                    <div className="flex-1 flex flex-col items-center justify-center text-gray-600 opacity-30">
                        <div className="text-9xl mb-4">üîç</div>
                        <p className="text-2xl font-bold">Aguardando pesquisa...</p>
                    </div>
                  )}

                  {searchState.data && (
                    <>
                      <div className="w-full max-w-4xl mx-auto mb-8 bg-dark-surface/50 border border-dark-border rounded-xl p-4 flex flex-col md:flex-row gap-4 items-center animate-fade-in">
                          <div className="flex-1 w-full">
                            <label className="text-xs text-gray-400 uppercase font-bold mb-1 block">Modificar pesquisa com IA</label>
                            <input type="text" value={refinementQuery} onChange={(e) => setRefinementQuery(e.target.value)} placeholder="Ex: Filtrar apenas os que abrem de s√°bado..." className="w-full bg-black/50 border border-dark-border rounded-lg px-4 py-2 text-white focus:border-neon outline-none text-sm" onKeyDown={(e) => e.key === 'Enter' && handleRefinement()} />
                          </div>
                          <button onClick={handleRefinement} disabled={isRefining || !refinementQuery.trim()} className="px-6 py-2 bg-dark-border hover:bg-white/10 text-white rounded-lg text-sm font-bold border border-white/10 transition-all">{isRefining ? 'Analisando...' : 'Aplicar Filtro'}</button>
                      </div>
                      <ResultsDisplay rawText={searchState.data} />
                    </>
                  )}
                </div>
              )}
            </div>
            <footer className="fixed bottom-0 w-full bg-black/90 border-t border-dark-border py-2 text-center text-[10px] text-gray-600 font-mono pointer-events-none">ALPHACLIENTS SYSTEM V2.1.0</footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>